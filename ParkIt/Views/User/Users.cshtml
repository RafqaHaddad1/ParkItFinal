@model ParkIt.ViewModel.EmployeeListViewModel

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.4/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.1.4/js/dataTables.js"></script>

    <title>@ViewData["Title"]</title>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 15px; /* Increased padding for wider cells */
            border: 1px solid #ccc;
            text-align: center;
            min-width: 120px; /* Ensure cells are wider */
        }

        th {
            background-color: #A9A9A9;
            color: #23282B;
        }

        tr:nth-child(even) {
            background-color: #ddd !important;
        }

        tr:nth-child(odd) {
            background-color: #ffffff !important;
        }

        .save-button2 {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #F3BC12;
            color: #23282B;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .profile-pic {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #F3BC12;
            border-radius: 50%;
            width: 100px;
            height: 100px;
            color: white;
            font-size: 40px;
            margin-bottom: 20px;
        }

        .modal .form-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background-color: #e0e0e0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .modal .form-left,
        .modal .form-right {
            display: flex;
            flex-direction: column;
            width: 48%;
        }

            .modal .form-left input,
            .modal .form-left select,
            .modal .form-right input {
                margin-bottom: 10px;
                padding: 8px;
                border: 1px solid #ccc;
                border-radius: 5px;
            }

        .modal .map-container {
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 10px;
            height: 400px; /* Adjust height as needed */
            margin-top: 20px; /* Ensure space between form and map */
        }

     

        .modal .save-button {
            align-self: flex-end;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #F3BC12;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        

    </style>

</head>
<body>
    <div class="container">
        <h1>@ViewData["Title"]</h1>
        <table id="User-table">
            <thead>
                <tr>
                    <th></th>
                    <th>ID</th>
                    <th>NAME</th>
                    <th>TITLE</th>
                    <th>ACTIVE</th>
                    <th>STATUS</th>
                    <th>LAST_ONLINE</th>
                    <th></th>
                
                </tr>
            </thead>
            <tbody>
                @if (Model?.Employees == null)
                {
                    <tr><td>No Data Available</td></tr>
                }
                else
                {
                    @foreach (var e in Model?.Employees)
                    {
                        <tr data-user-id="@e.Employee_ID">
                            <td><img src="@Url.Content("~/Images/UserIcon.png")" style="width: 35px; height: 35px;background-color: transparent;display: block;" alt="Icon" /></td>
                            <td>@e.Employee_ID</td>
                            <td>@e.Name</td>
                            <td>@e.Title</td>
                            <td>
                                @if(e.Active){
                                    <p>On</p>
                                }
                                else
                                {
                                    <p>Off</p>
                                }
                            </td>
                            <td></td>
                            <td></td>
                            <td>
                                <a onclick="EditUser(@e.Employee_ID)" class="btn btn-primary" style="background-color: #F3BC12; border-color:#F3BC12; color:#23282B">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <button class="btn btn-danger" onclick="deleteUser(this,@e.Employee_ID)" style="background-color: #23282B; border-color:#23282B; color:#F3BC12">
                                    <i class="fas fa-trash"></i>
                                </button>

                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
        <button onclick="location.href='@Url.Action("AddUser", "User")'" class="save-button2">Add</button>




    </div>

    <div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="editEventModalLabel">User Info</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeEditModal" onclick="$('#editEventModal').modal('hide');"></button>
                </div>
                <div class="modal-body">
                    <div class="form-container">
                        <div class="form-left">
                            <label for="Employee_ID">Employee_ID</label>
                            <input type="number" id="Employee_ID" name="Employee_ID"  readonly/>
                            <label for="Employee_Name">Employee Name</label>
                            <input type="text" name="Name" placeholder="Name" readonly />
                            <div class="form-group radio-group">
                                <label>Title</label>
                                <div>
                                    <input type="radio" id="Runner" name="Title" value="Runner" disabled>
                                    <label for="Runner">Runner</label>
                                </div>
                                <div>
                                    <input type="radio" id="Supervisor" name="Title" value="Supervisor" disabled>
                                    <label for="Supervisor">Supervisor</label>
                                </div>

                            </div>
                            <div id="supervisor-container" style="display: none;">
                                <label for="supervisor">Supervisor Name</label>
                                <input type="text" id="supervisor" name="supervisor" readonly />
                            </div>
                            <label>
                                <input type="checkbox" name="Active" value="true" id="active-checkbox" disabled>
                                Active
                            </label>
                            <label for="PhoneNumber">Phone Number</label>
                            <input type="text" name="PhoneNumber" placeholder="Phone" readonly />
                            <label for="Address">Address</label>
                            <input type="text" name="Address" placeholder="Address" readonly />
                            <label for="NfcCode"> NFC Code</label>
                            <input type="text" name="NfcCode" placeholder="NFC Code" readonly />
              
                        </div>
                        <div class="form-right">
                            <label for="Zone_Name">Zone Name</label>
                            <input type="text" name="Zone_Name" placeholder="Zone_Name" readonly />
                            <label for="Subzone_Name">Subzone Name</label>
                            <input type="text" name="Subzone_Name" placeholder="Subzone_Name" readonly />
                            <div class="form-group radio-group">
                                <label>Employm
                                    ent Type:</label>
                                <div>
                                    <input type="radio" id="partTime" name="EmploymentType" value="PartTime" disabled>
                                    <label for="partTime">Part Time</label>
                                </div>
                                <div>
                                    <input type="radio" id="fullTime" name="EmploymentType" value="FullTime" disabled>
                                    <label for="fullTime">Full Time</label>
                                </div>
                            </div>
                            <label for="Kafeel">Kafeel</label>
                            <input type="text" name="Kafeel" placeholder="Kafeel" readonly/>
                            <label for="AdditionalNotes">Additional Notes</label>
                            <input type="text" name="AdditionalNotes" placeholder="Additional Notes" readonly />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

    <script>
        function deleteUser(btn,uid) {
            if (confirm('Are you sure you want to delete this user?')) {
                $.ajax({
                    url: '@Url.Action("Remove", "User")',
                    type: 'POST',
                    data: { id: uid },
                    success: function (result) {
                        if (result.success) {
                            // Optionally reload the page to reflect the changes
                        $(btn).closest('tr').remove();
                        
                        } else {
                            alert('Error deleting user');
                        }
                    },
                    error: function (err) {
                        // Handle error
                        console.error(err);
                        alert('Error deleting user');
                    }
                });
            }
        }

    function EditUser(id) {
        if (confirm('Are you sure you want to edit this user?')) {
            // Redirect to edit page or handle form population here
            window.location.href = '@Url.Action("EditUser", "User")/' + id;
            
        }
    }


    $(document).ready(function () {
        $('#User-table').DataTable();
    });

    $(document).on('click', 'tr[data-user-id]', function () {
        var userId = $(this).data('user-id');
        fetchUserDetails(userId);
        $('#editEventModal').modal('show');
    });
    function fetchUserDetails(userId) {
        $.ajax({
            url: '/User/GetUserDetails',
            type: 'GET',
            data: { id: userId },
            success: function (result) {
                if (result.success) {
                    console.log(result);
                    populateModal(result.data);
                    $('#editEventModal').modal('show');
                } else {
                    alert('Error fetching zone details');
                }
            },
            error: function (err) {
                console.error(err);
                alert('Error fetching zone details');
            }
        });
    }
    function populateModal(user) {
        $('#Employee_ID').val(user.employee_ID);
        $('input[name="Name"]').val(user.name);
        $('input[name="PhoneNumber"]').val(user.phone);
        $('input[name="Address"]').val(user.address);
        $('input[name="NfcCode"]').val(user.nfcCode);
        $('input[name="Zone_Name"]').val(user.zone_Name);
        $('input[name="Subzone_Name"]').val(user.subzone_Name);
        $('input[name="Kafeel"]').val(user.kafeel);
        $('input[name="AdditionalNotes"]').val(user.additionalNotes);
        $('#supervisor').val(user.supervisor);
        $('#active-checkbox').prop('checked', user.active);
        $('input[name="Title"][value="' + user.title + '"]').prop('checked', true);
        $('input[name="EmploymentType"][value="' + user.type + '"]').prop('checked', true);

        if (user.title === "Runner") {
            // Show the supervisor input and set it as readonly
            $('#supervisor-container').show();
            $('#supervisor').val(user.supervisor).prop('readonly', true);
        } else {
            // Hide the supervisor input
            $('#supervisor-container').hide();
        }
    
    }



</script>



</html>
